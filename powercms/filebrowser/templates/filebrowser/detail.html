{% extends "admin/base_site.html" %}

<!-- LOADING -->
{% load static i18n fb_tags fb_versions %}

<!-- STYLESHEETS -->
{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}" />
{% endblock %}

{% block extrahead %}
    <script type="text/javascript" src="{% static "admin/js/vendor/jquery/jquery.js" %}"></script>
    <script type="text/javascript" src="{% static "admin/js/jquery.init.js" %}"></script>
    <script type="text/javascript">
        $(document).ready(function($) {
            $('.path_to').hide();
            $('#id_custom_action').change(function(event) {
                if($(this).val() == 'move'){
                    $('.path_to').show();
                    $('.submit-row input[name="_continue"]').hide();
                }else{
                    $('.path_to').hide();
                    $('.submit-row input[name="_continue"]').show();
                }
            });
        });
    </script>
{% endblock %}

<!-- COLTYPE/BODYCLASS -->
{% block bodyclass %}change-form filebrowser{% if query.pop %} popup{% endif %}{% endblock %}
{% block coltype %}colM{% endblock %}

<!-- BREADCRBUMBS -->
{% block breadcrumbs %}{% include "filebrowser/include/breadcrumbs.html" %}{% endblock %}

<!-- CONTENT -->
{% block content %}
<div id="content-main">
    {% block object-tools %}
        <ul class="object-tools">
            <li><a href="{% url 'filebrowser:fb_history' %}{% query_string %}">{% trans "Historico" %}</a></li>
        </ul>
    {% endblock %}
    <form action="{% query_string "" "filter_date,filter_type,q,p" %}" method="post">{% csrf_token %}
        <div>
            {% if form.errors %}<p class="errornote">{% trans 'Please correct the following errors.' %}</p>{% endif %}
            <fieldset class="module aligned">
                <div class="form-row field-{{ form.name.name }}{% if form.name.errors %} errors{% endif %}">
                    {% if form.name.errors %}{{ form.name.errors }}{% endif %}
                    <div>
                        <label class="required" for="id_name">{{ form.name.label }}</label>
                        {{ form.name }}
                        {% if form.name.help_text %}<p class="help">{{ form.name.help_text|safe }}</p>{% endif %}
                    </div>
                </div>
            </fieldset>
            {% if fileobject.filetype == "Image" %}
            <fieldset class="module aligned">
                <h2>{% trans "Edit" %}</h2>
                <div class="form-row {% if form.custom_action.errors %}errors{% endif %}">
                    {% if form.custom_action.errors %}{{ form.custom_action.errors }}{% endif %}
                    <div>
                        <label class="required" for="id_custom_action">{{ form.custom_action.label }}</label>
                        {{ form.custom_action }}
                        {% if form.custom_action.help_text %}<p class="help">{{ form.custom_action.help_text|safe }}</p>{% endif %}
                    </div>
                </div>
                <div class="form-row path_to {% if form.path_to.errors %}errors{% endif %}">
                    {% if form.path_to.errors %}{{ form.path_to.errors }}{% endif %}
                    <div>
                        <label class="required" for="id_path_to">{{ form.path_to.label }}</label>
                        {{ form.path_to }}
                        {% if form.path_to.help_text %}<p class="help">{{ form.path_to.help_text|safe }}</p>{% endif %}
                    </div>
                </div>
            </fieldset>
            {% endif %}
            {% if fileobject.filetype == "Folder" %}
            <fieldset class="module aligned">
                <h2>{% trans "Folder Information" %}</h2>
                <div class="form-row">
                    <div>
                        <label>{% trans "Date" %}</label>
                        <p>
                            {{ fileobject.datetime|date:"N j, Y" }}
                        </p>
                    </div>
                </div>
            </fieldset>
            {% endif %}
            {% if fileobject.filetype != "Folder" %}
            <fieldset class="module aligned">
                <h2>{% trans "File Information" %}</h2>
                <div class="form-row">
                    <div>
                        <label>{% trans "URL" %}</label>
                        <p>
                            <a href="{{ fileobject.url }}">{{ fileobject.url }}</a>
                        </p>
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>{% trans "Filesize" %}</label>
                        <p>
                            {{ fileobject.filesize|filesizeformat }}
                        </p>
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>{% trans "Date" %}</label>
                        <p>
                            {{ fileobject.datetime|date:"N j, Y" }}
                        </p>
                    </div>
                </div>
                {% if fileobject.filetype == "Image" %}
                    <div class="form-row">
                        <div>
                            <label>{% trans "Size" %}</label>
                            <p>
                                {{ fileobject.width }} x {{ fileobject.height }} px
                            </p>
                        </div>
                    </div>
                {% endif %}
            </fieldset>
            {% endif %}
            {% if fileobject.filetype == "Code" %}
            <fieldset class="module aligned">
                <h2>{% trans "Arquivo" %}</h2>
                <div class="form-row">
                    <div>
                        <textarea name="file" id="source" style="display: none">{{ fileobject.read }}</textarea>
                        <pre id="editor">{{ fileobject.read }}</pre>
                    </div>
                </div>
            </fieldset>
            {% endif %}
            {% if fileobject.filetype == "Image" %}
            <fieldset class="module aligned wide">
                <h2>{% trans "Image Versions" %}</h2>
                {% if settings_var.ADMIN_THUMBNAIL %}
                <div class="form-row">
                    <div>
                        <label>{% trans "Thumbnail" %}</label>
                        <img src="{% version fileobject.path settings_var.ADMIN_THUMBNAIL %}" title="{% trans 'View Image' %}" />
                    </div>
                </div>
                {% endif %}
                {% if settings_var.ADMIN_VERSIONS %}
                    {% for version in settings_var.ADMIN_VERSIONS %}
                        {% version_object fileobject version as image_version %}
                        {% version_setting version %}
                        <div class="form-row">
                            <div>
                                <label>{{ version_setting.verbose_name }}</label>
                                <img src="{{ image_version.url }}" />
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </fieldset>
            {% endif %}
            <div class="submit-row">
                <p class="deletelink-box">
                    <a href="{% url 'filebrowser:fb_delete_confirm' %}{% query_string %}" class="deletelink">{% trans "Delete" %}</a>
                </p>
                <input type="submit" value="{% trans 'Save' %}" class="default" />
                <input type="submit" value="{% trans 'Save and continue editing' %}" class="" name="_continue" />
            </div>
        </div>
    </form>
</div>

<script src="{% static 'ace/ace.js' %}"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/tomorrow");
    editor.session.setMode("ace/mode/html");
    editor.setAutoScrollEditorIntoView(true);
    editor.setOption("maxLines", 35);

    var textarea = document.getElementById('source');
    editor.getSession().setValue(textarea.value);
    editor.getSession().on('change', function(){
      textarea.value = editor.getSession().getValue();
    });

</script>
{% endblock %}